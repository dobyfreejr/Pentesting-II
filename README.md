# Penetration Test Report
## Crisis & Threat Mitigation & Solutions Group, LLC
-------



### **Confidentiality Statement**


##### *This document contains confidential and privileged information from MegaCorpOne Inc. (henceforth known as MegaCorpOne). The information contained in this document is confidential and may constitute inside or non-public information under international, federal, or state laws. Unauthorized forwarding, printing, copying, distribution, or use of such information is strictly prohibited and may be unlawful. If you are not the intended recipient, be aware that any disclosure, copying, or distribution of this document or its parts is prohibited.*





## *Contact Information*

 ## **Company Name** 
 ### **Crisis & Threat Mitigation & Solutions Group , LLC** 

| Contact Name | Kyle Barbre|
| ------ | ---------- |
| Contact Title   | Sr. Penetration Tester |
| Contact Phone | 888.888.8888 |
| Contact Email  | k.barbre@ctms.com |



### **Document History Pentesting Team**

| Author Name  | Title | 
| ------ | ----------- | 
| Destiny Nevarez | Sr Pentester |
| Derrik Hoke | Sr. Pentester |
| Tyler Jobson | Sr. Pentester |
| Ryan Bryne  | Sr. Pentester |
| Katie Diaz | Sr. Pentester |




# **Introduction**

In accordance with MegaCorpOne’s policies,Crisis Threat Mitigation Solutions Group, LLC (henceforth known as (CTMS) conducts external and internal penetration tests of its networks and systems throughout the year. The purpose of this engagement was to assess the networks’ and systems’ security and identify potential security flaws by utilizing industry-accepted testing methodology and best practices. The project was conducted on a number of systems on MegaCorpOne’s network segments by CTMS during October of 2022.

For the testing, CTMS focused on the following:

Attempting to determine what system-level vulnerabilities could be discovered and exploited with no prior knowledge of the environment or notification to administrators.
Attempting to exploit vulnerabilities found and access confidential information that may be stored on systems.
Documenting and reporting on all findings.

All tests took into consideration the actual business processes implemented by the systems and their potential threats; therefore, the results of this assessment reflect a realistic picture of the actual exposure levels to online hackers. This document contains the results of that assessment.

# **Assessment Objective**

The primary goal of this assessment was to provide an analysis of security flaws present in MegaCorpOne’s web applications, networks, and systems. This assessment was conducted to identify exploitable vulnerabilities and provide actionable recommendations on how to remediate the vulnerabilities to provide a greater level of security for the environment.

CTMS used its proven vulnerability testing methodology to assess all relevant web applications, networks, and systems in scope. 

MegaCorpOne has outlined the following objectives:


**Table 1: Defined Objectives**

Objective:
Find and exfiltrate any sensitive information within the domain.
Escalate privileges to domain administrator.
Compromise at least two machines.





# *Penetration Testing Methodology*


### **Reconnaissance** 

CTMS begins assessments by checking for any passive (open source) data that may assist the assessors with their tasks. If internal, the assessment team will perform active recon using tools such as Nmap and Bloodhound.

### **Identification of Vulnerabilities and Services**

CTMS uses custom, private, and public tools such as Metasploit, hashcat, and Nmap to gain perspective of the network security from a hacker’s point of view. These methods provide MegaCorpOne with an understanding of the risks that threaten its information, and also the strengths and weaknesses of the current controls protecting those systems. The results were achieved by mapping the network architecture, identifying hosts and services, enumerating network and system-level vulnerabilities, attempting to discover unexpected hosts within the environment, and eliminating false positives that might have arisen from scanning. 

### **Vulnerability Exploitation**

CTMS’s normal process is to both manually test each identified vulnerability and use automated tools to exploit these issues. Exploitation of a vulnerability is defined as any action we perform that gives us unauthorized access to the system or the sensitive data. 

## **Reporting**

Once exploitation is completed and the assessors have completed their objectives, or have done everything possible within the allotted time, the assessment team writes the report, which is the final deliverable to the customer.



## *Scope*
------
Prior to any assessment activities, MegaCorpOne and the assessment team will identify targeted systems with a defined range or list of network IP addresses. The assessment team will work directly with the MegaCorpOne POC to determine which network ranges are in-scope for the scheduled assessment. 

It is MegaCorpOne’s responsibility to ensure that IP addresses identified as in-scope are actually controlled by MegaCorpOne and are hosted in MegaCorpOne-owned facilities (i.e., are not hosted by an external organization). In-scope and excluded IP addresses and ranges are listed below. 

| IP Address/URL  | Descriptions| 
| ------ | ----------- | 
| 172.16.117.0/16 |MegaCorpOne internal domain, range and public website |
| mco.local|  |
| megacorpone.com |  |










## *Summary of Weaknesses

CTMS successfully found several critical vulnerabilities that should be immediately addressed in order to prevent an adversary from compromising the network. These findings are not specific to a software version but are more general and systemic vulnerabilities.

**Note: All screen shots are from all pentesters within the CTMS pentesting team. Authors' names are above on page 5.**
  

  ![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/1.img.png)


 From the image above you can see that I was able to grab a directory from the server that helps run everything. This shouldn’t be available to the public. I am also able to see what apache server version it's running.




![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/2.png)


After searching for the Robots.txt as a subdirectory off the main webpage. The web application returned a nanites.php. I went ahead and went to that page to be able to see what was hidden.

![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/3.png)

Image above shows all the different web versions of the web application that has been modified over the time of the web application that's been running. This shouldn't be visible to the public. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/4.png)
 Image above shows an NS lookup of the website to see what IP were registrar to the Websites domain name. This image was also taken by Tyler, another member of the group.

![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/5.png)
Used shodan.io to find what ports were open on the server running the web application. Having too many open ports allows for people to be able to pentest them and find weaknesses inside those ports. This search also shows where the server is located as well.

![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/6.png)
Images above show who owns the web application. It also shows the website's vulnerabilities. Now having the vulnerabilities it allows me to be able to target the application better to be able to penetrate. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/7.png)






Images show who owns the website's ISP provider. Where it is located in the world. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/8.png)


Open ports 22 which is known for ssh port 80 and port 443. Port 22 should be closed unless its being binded via a ssh key from a computer to the network. Would allow for it to be much more secure. Have port 80 and 443 are normal but can also be exploited

![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/9.png)

Above image shows that they are using an SSH key pair. Which does help prevent people just brute forcing their way into the network. They would have to brute force the computer that holds the ssh key instead.

![](https://github.com/dobyfreejr/Pentesting-II/blob/32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/9.png)

Used recon-ng to be able to see vulnerabilities in the web application. From the image you can see I put in my shodan key to be able to test for known vulnerabilities in the application. From doing this I was able to find that there were subdomains on the domains network. Running an audit to be able to see if there are vectors of attack. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/
32f6e2e0afc9b33ac6a0e22633af86e5bb6e2e18/img/11.png)

This is a small list of different CVE that can ,and were used against the web application.This was found on a public found database that was run against the network. These are some of the weaknesses that were found. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/12.png)

After reviewing this list we found vpn.megacorpone.com presents us with a login. Using the basic password and the list we got earlier we were able to obtain access to the server. Having better more secure passwords would prevent this from happening. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/13.png)

Using basic password combinations allows me to gain access to the server. To prevent this to best to use complex passwords as well as using MFA to gain access to the network.

![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/14.png)


Was able to download the company vpn and use it to log onto the server now that I have brute forced my way into the server. Which will allow for easier connecting in the future . Solution is to remove easy passwords from people. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/15.png)

Downloaded the vpn. After a small amount of configuration of the vpn.sh file I was able to use it to allow my computer . Solution to prevent people from being able to download the vpn. They shouldn't be able to configure the file. It should never be open to the general public. I know this was hidden behind a password and username but both were rather easy to get and then used to be able to gain further access to the network. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/16.png)

Image above shows how once I was inside the network I was able to grab more information about the server. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/17.png)

Once obtaining access to the network we started to scan to see what else was on the network using a tool called Zenmap . A graphical front end for a terminal tool called nmap. This tool allows us to see what open ports were available on the local network as well as info on version types. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/18.png)

After doing a basic scan we found a system at 172.22.117.150 and realized the ftp was open and ran an advanced scan to see what other information we could learn. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/19.png)

Based on the entry in reference to port 21 we selected a script to run within Zenmap that would look for vulnerabilities using the “script ftp-vsftpd-backdoor”. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/20.png)

After finishing the scan we found that the system was vulnerable to exploitation dye to outdated software. 
![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/21.png)

The image shows what version of ftp software that was being used.  
![](https://github.com/dobyfreejr/Pentesting-II/blob/3ca6d095f21208d2c7ef5850e7747fe92a2bf784/img/22.png)

By using an additional open source database search tool named searchsploit. It allows me to search for the exploit I needed in order to perform the exploit

![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/23.png)

Using the exploit we were able to gain full root access to the server. The server that was exploited was 172.22.117.150
![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/24.png)

Once having access I did a search to find stored passwords or admin files. Upon doing this I found a file called adminpasswords.txt.
![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/25.png)

It shows clear text passwords and usernames. 

![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/26.png)

With information gather was able to use msfadmin to log into the server. 
![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/27.png)

Once we was in, we did basic privilege escalation. Allow us to gain root privileges, 
![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/28.png)

Once Obtaining access we found more user name and passsword hashes ,which was saved and used later on. 
![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/29.png)

moved all data to the local machine. 
![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/30.png)

Then ran John the ripper against the passwords hashes. 
![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/31.png)


This poccess quickly shows that the passwords are not secure.  This will  allow for further exploration of the network as a whole. 
![](https://github.com/dobyfreejr/Pentesting-II/blob/34085a317180e6a7f7327e6b378c82433a3f790e/img/32.png)

We created the ability to persistently access the machine by changing the port that we will be connecting over. As a result we will no longer be connecting over port 22 instead connecting over port 10022.This will prevent the network from alerting the network admin of our presents. 
![]()

Additionally we created a system account to remain further undetected from the admins. Gave the account root privileges so that it can continue to be exploited. 
![]()

After further exploiting the linux server on the network. We move our focus to the Windows system.
![]()

On our initial nmap scan on 172.22.117.0/24 we found two systems. One windows domain controller WinDoc01@172.22.117.10 and a windows 10 @ 172.22.117.20 system.Was able to identify the domain controller from scan of 445(SMB) ,135 RPC and 88 kerberos ,and the windows 10 machine had 
open ports 135 and 445 and not kerberos as it is a port used for network authentication by the domain controller. 


![]()

After finding this information we open another open source tool called metasploit. That also interfaces with information from exploit-db.com/ We loaded a tool for SMB protocal 
![]()

After configuring the information we obtained in the previous process of the pentest username we used was tstark and password Password! to exploit the domain and subnet.

![]()



                            
After running the exploit which using a process called password spraying we were able to see that the subnet authentication we was looking for was on .10 and .20 
![]()

We used a resource called responder which listens for LLMNR  broadcasts to be able to obtain any data being sent over the network and grab hashes. 
![]()

The account pparker was found and the hash was placed into a text file to be ran against john the ripper. 
![]()

Next we wanted to see if the newly gain credentials we got from password spraying would allow us perform commands on the machine remotely. In order to do this we loaded another module in metasploit that would allow us to test this and configure it to using know username and passwords
on the windows machine. 
![]()

Initially we tested the whoami and after that we decide to see what services are running on the system. 


![]()



Once finding that the first two commands ran we decide to collect more information on the system including hardware software active user account and network file shares. 

![]()
Building a payload into the system
![]()

After discovering this additional information we built a payload that would give us additional ways to access the system. Using the tool that was part of metasploit called msvenom we created a reverse shell connection to backdoor my way around the Antivirus or firewalls . Using credentials i got early in the pentesting.We used that account to upload the ssh payload.
![]()

Next we returned to our attacking system and setup a listener for a connection coming from the remote system and establish the connection. 

![]()




Once we had a handler running locally to create a direct link to the remote system.

![]()
With that connection made we went back to wmi executables auxiliary tools we used with metasploit to try and open a shell on the remote host/ Once we ran the tool we had an active session to the machine and a shell to use as we need for additional exploring.
![]()

The session remains open even after exiting the session which can be used later for more exploring. 

![]()

Now that we have a connection that we can use as needed. Additional privileges to continue with making sure we remain in the system  need to be made.
![]()

We proceed with putting the current session in the background and using additional exploits that would allow us to connect to the system account we escalated our privileges with already. If a hacker was to use this they wouldn’t use such an easy name to find for the admin
![]()

To make sure that the shell would continue in the future without having to constantly reinstate the shell , add it to the cron jobs so it will restart every time upon the computer rebooting. We tested the task to make sure that when the time came it ran properly. As it did we were happy with the results. If a hacker was to do this they wouldn't make the name or task so easily findable. 

![]()

While we had access to the windows 10 machine we tried to grab any and all additional credentials we could locate. 
We decided to use a tool called minikatz ,which is a tool within metasploit using the kiwi command to pull down any cached hashes that might be readily available to us. To do this we used a new meterpreter session using an smb exploit and the compromised tstark account

![]()



Next we used the Kiwi module. 

![]()


Which we ran the command to pull the cached hashes.
After gathering all the hashes we put them into a local text file and found a new username bbanner. We used a different command with John the ripper then in the past. We pointed our darts  more at mscacheV2 in order to crack the hashes.

![]()


Next we background the current session to the Windows 10 machine and take note of the session ID that was created. Started a new session to move to the domain controller on the network. This next process takes place from the windows 10 machines going towards the Domain controller and not from the attacking machine to the Domain controller. This cover any tracks that could be made going into the server from the internet. It makes it easier for exploits to be done on the server because it likely by passes any prevention intrusion systems in places. 

![]()

For this exploit we used an wmi exploit and loaded the information into it ,including IP for the domain controller the new credentials we found for bbanner, and the session ID of exploit running on the windows 10 machine and exploited it. 
![]()

This process took a few tries to successfully work. It did eventually create a session on the Domain Controller that was accessible to us. 
![]()

To obtain additional credentials now that we have access to the domain controller we use more tools provided to us from the kiwi module to pull more hashes and use John to crack. 
![]()

First to get a list of local user accounts. We ran net users
Then we took those hashes and placed them in a local text file and ran them through John and formatted it to use a NT format. 
![]()


# **Executive Summary**

CTMS conducted its pentesting report against Megacorpone Corporation. The following was found after an in depth search and testing of all networks and domains within our scope.
We began our pentesting with testing the website. Using a common technique called “dorking” we were able to see several publicly available information about members of the company on the website. From there we went ahead and saw that there was an asset page available to us. Inside we found out that the webpage was running off of an outdated apache 2.4.28 software. We would later use that to be exploited. Additionally we found lots of emails and names and positions of people. We put that into a local file to have as we proceed with the pentesting. While having email on the website is common practice it is best to not have users have the same username and passwords as emails. In some additional searching of the website we found a robot.txt file in which we found nanities.php that we shouldn’t have been able to see. This is version information that should be seen to by the public and could cause issues for the company down the line. Using basic networking tools like nslookup in the terminal . We found there were three possible exploitable points. After using this we used another free tool called shodan.io This allows us to see exploits and attack vectors that could be used against the application. We found open ports that to the normal person wouldn’t seem out of place. In fact port 22 ,80 ,443 is bad. There are several Exploits that can be used against that . Screenshot was provided on the CVE that can be used. Moving from the web application we focused our attention to the network itself. We did a recon-ng and it provided us with information that there was a domain controller. We also saw several servers under the domain controller. We were able to crack the VPN with basic username/password . This should be more secure. From here we started to separate the networkout.  The network we found was 172.22.117.0/24 so we subnetted that to find the three networks we wanted. 172.22.117.150 was the linux machine 172.22.117.10 was the Domain Controller and 172.22.117.20 was the Windows machine. Now we needed to see what ports were open and what services were running on the network/machines. We ran a Nmap of the windows machine and was able to use metasploit to exploit SMB protocol to gain access to the machine. From here we use a technique called password spraying in order to see where the password and username tstark would work across the subnet. We found that it both accessed the Domain Controller as well as the windows 10 machine. We were able to gain access from the windows machine to the Domain controller. Once we had control of the network we decided to set up backdoors to allow for us to remain in control of the network. We did that through multiple means. We made it through a cron job setup , as well as making it so the account we make to log it appears as a system grade account and the service port we call on is different then the means in which we gain access to the system. Goal is to continue exploring and see what if any more credentials and sensitive data can be found.  




Summary Vulnerability Overview


Vulnerability
Severity
Weak password on public web application
Critical
VPN easily accessible 
Critical
VPN easily accessible 
High
Reverse shell exploit
      High
Having Passwords stored in plain text
Medium
Outdated software versions
Low



The following summary tables represent an overview of the assessment findings for this penetration test

Scan Type
Total
Hosts
2
Ports
4


Exploitation Risk
Total
Critical
1
High
2
Medium
1
Low
1




Vulnerability Findings

Weak Password on Public Web Application

Risk Rating: Critical

Description: 
The site vpn.megacorpone.com is used to host the Cisco AnyConnect configuration file for MegaCorpOne. This site is secured with basic authentication but is susceptible to a dictionary attack. CTMS was able to use a username gathered from OSINT in combination with a wordlist in order to guess the user’s password and access the configuration file.

Affected Hosts: vpn.megacorpone.com

Remediation: 

Set up two-factor authentication instead of basic authentication to prevent dictionary attacks from being successful.
Require a strong password complexity that requires passwords to be over 12 characters long, upper+lower case, & include a special character.
Reset the user thudson’s password.

VPN Easily Accessible 
Risk Rating: High

Description: 
The VPN was open to the public. The  VPN used password/usernames that didn’t contant good passwords.Upon gain access I was able to gain access to the network 

Affected Hosts: vpn.megacorpone.com

Remediation: 
Complex passwords 
Using MFA for logging on.

Reverse Shell Exploit 
Risk Rating: High

Description: 
Having a reserve shell on your system allows the hacker to maintain access to the network to perform malicious activities. It prevents the system from being able to detect what the hacker is doing. Which allows for further exploitations  

Affected Hosts: Windows machine/ Linux machine/ Domain Controller

Remediation: 
Weekly /monthly check to make sure files have not been edited.
Run a weekly scan to boot all unknown IP from the network.
Make an White list of all known IPs coming into the network. 
 
Having Plain Text Passwords Stored
Risk Rating: Medium

Description: 
Had a plain text file with admin usernames and passwords. That should never be in plain text.	

Affected Hosts: Linux Machine

Remediation: 
Always encrypt your data especially with passwords 
Never Store passwords in text files. 



Outdated Web Application Software
Risk Rating: Low

Description: 
The website's application software is outdated. Needs to be updated to prevent known exploits to be used against the application. Outdated software can be used as vectors for future attacks.

Affected Hosts: vpn.megacorpone.com

Remediation: 
See if a different software offers the solution if the current software doesn’t prevent it. 
Keep software updated with patches or versions known to not have such bad exploits.

Grading Methodology

Each finding was classified according to its severity, reflecting the risk each such vulnerability may pose to the business processes implemented by the application, based on the following criteria:

Critical:	 Immediate threat to key business processes.
High:		 Indirect threat to key business processes/threat to secondary business processes.
Medium:	 Indirect or partial threat to business processes. 
Low:		 No direct threat exists; vulnerability may be leveraged with other vulnerabilities.
Informational:    No threat; however, it is data that may be used in a future attack.

As the following grid shows, each threat is assessed in terms of both its potential impact on the business and the likelihood of exploitation:
